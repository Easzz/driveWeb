<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>搜索项目</title>
		<link rel="stylesheet" href="../lib/layui-v2.6.3/css/layui.css" media="all">
	</head>
	<body>
		<div id="formDemo" class="layui-form">
			<br>
			<input type="hidden" id="projectId" />
			<input type="hidden" id="projectName" />
			<div class="layui-row">
				<div class=" layui-col-md5">
					<label class="layui-form-label">请输入项目</label>
					<div class="layui-input-block">
						<select id="project" lay-verify="" lay-search>
							<option value=""></option>
						</select>
					</div>
				</div>

				<div class=" layui-col-md3">
					<div class="layui-input-block">
						<!-- <button id="btn" class="layui-btn" lay-submit lay-filter="*">立即提交</button> -->
						<button id="btn" class="layui-btn" lay-submit lay-filter="*">搜索</button>
						<!-- <button type="reset" class="layui-btn layui-btn-primary">重置</button> -->
					</div>
				</div>
			</div>
			<!-- 更多表单结构排版请移步文档左侧【页面元素-表单】一项阅览 -->
		</div>

		<br/>
		<br/>
		<br/>

		<div class="layuimini-container">
			<div class="layuimini-main">
				<fieldset class="table-search-fieldset">
					<legend>搜索信息</legend>
					<div style="margin: 10px 10px 10px 10px">
						<form class="layui-form layui-form-pane" action="">
							<div class="layui-form-item">
								<div class="layui-inline">
									<label class="layui-form-label">平台名称</label>
									<div class="layui-input-inline">
		<!--								<input type="text" id="terrace" name="terraceName" autocomplete="off" class="layui-input">-->
										<select id="terrace" name="terraceId" lay-search lay-verify="required">
											<option value="">请选择平台</option>
										</select>

									</div>
								</div>

								<div class="layui-inline">
									<button type="submit" class="layui-btn layui-btn-primary"  lay-submit lay-filter="data-search-btn"><i class="layui-icon"></i> 搜 索</button>
								</div>
							</div>
						</form>
					</div>
				</fieldset>

				<table class="layui-hide" id="currentTableId" lay-filter="currentTableFilter"></table>

			</div>
		</div>

		<script src="../lib/layui-v2.6.3/layui.js"></script>
		<script src="../js/jquery-3.5.1.min.js"></script>
		<script src="../js/common.js"></script>
		<script>
			$(function() {
				$.ajax({
					url: apiUrl+'project/getProjectList',
					type: 'get',
					dataType: 'json',
					success: function(res) {
						//方法中传入的参数data为后台获取的数据
						var role = document.getElementById("project");
						var data = res.data;
						for (var i = 0; i < data.length; i++) {

							var id = data[i].id;
							var value = data[i].projectName;
							//   alert(value+label);

							var option = document.createElement("option"); // 创建添加option属性
							option.setAttribute("value", id); // 给option的value添加值

							option.setAttribute("data-id", id);
							option.innerText = value; // 打印option对应的纯文本
							role.appendChild(option); //给select添加option子标签

						}
						form.render("select");


					}
				})
			})

			layui.use(['form','table'], function() {
				var form = layui.form,
				table = layui.table;


				table.render({
					elem: '#currentTableId',
					url: apiUrl+'/project/getProjectList',
					toolbar: '#toolbarDemo',
					defaultToolbar: ['filter', 'exports', 'print', {
						title: '提示',
						layEvent: 'LAYTABLE_TIPS',
						icon: 'layui-icon-tips'
					}],
					cols: [[
						// {type: "checkbox", width: 50},
						{field: 'id',  title: 'ID',width:10},
						{field: 'projectName',  title: '项目名'},
						{field: 'terraceName',  title: '平台名'},
						{field: 'gmtCreate',  title: '创建时间'}

					]],
					limits: [10, 15, 20, 25, 50, 100],
					limit: 15,
					page: false,
					skin: 'line'
				});

				//各种基于事件的操作，下面会有进一步介绍

				$(function() {
					$.ajax({
						url: apiUrl+'/project/getProjectList',
						type: 'get',
						dataType: 'json',
						success: function(res) {
							//方法中传入的参数data为后台获取的数据
							var role = document.getElementById("project");
							var data = res.data;
							for (var i = 0; i < data.length; i++) {

								var id = data[i].id;
								var value = data[i].projectName;
								//   alert(value+label);

								var option = document.createElement("option"); // 创建添加option属性
								option.setAttribute("value", id); // 给option的value添加值

								option.setAttribute("data-id", id);
								option.innerText = value; // 打印option对应的纯文本
								role.appendChild(option); //给select添加option子标签

							}
							form.render("select");


						}
					})
				})



				form.on("select", function(data) {
					console.log(data.value); // 获取选中的值
					var projectId = data.value;
					$("#projectId").val(projectId);


				});

				$("#btn").on('click', function() {


					var projectId = $("#projectId").val();
					console.log(projectId)
					if(projectId==''){
						alert("请选择项目");
						return;
					}

					  var a=$("#project option:selected").text();//获取文本
					window.location.href="detail.html?projectId="+projectId+"&projectName="+a;

				});



			});
		</script>
	</body>
</html>
